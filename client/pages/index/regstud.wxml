<!--pages/index/regstud.wxml-->
<view class="weui-toptips weui-toptips_warn" wx:if="{{errorShow}}">{{errorMessage}}</view>

<block wx:if="{{not_reg}}">
  <form bindsubmit="regstudSubmit">
    <view class="weui-cells__title">报名学校</view>
    <view class="weui-cells weui-cells_after-title">
      <view class="weui-cell weui-cell_select">
        <view class="weui-cell__hd weui-cell__hd_in-select-after">
          <view class="weui-label">学校选择</view>
        </view>
        <view class="weui-cell__bd">
          <picker bindchange="schoolChange" value="{{schIndex}}" range="{{schools}}" range-key="name">
            <view class="weui-select weui-select_in-select-after">{{schools[schIndex].name}}</view>
          </picker>
        </view>
      </view>
    </view>

    <view class="weui-cells__title">报名学生</view>
    <view class="weui-cells weui-cells_after-title">
      <view class="weui-cell weui-cell_select">
        <view class="weui-cell__hd weui-cell__hd_in-select-after">
          <view class="weui-label">学生选择</view>
        </view>
        <view class="weui-cell__bd">
          <picker bindchange="childChange" value="{{childIndex}}" range="{{childs}}" range-key="child_name">
            <view class="weui-select weui-select_in-select-after">{{childs[childIndex].child_name}}</view>
          </picker>
        </view>
      </view>
    </view>
    <view style="margin:0 auto; width: 50%; margin-bottom: 30rpx;">
      <view class="weui-btn-area">
        <button type="primary" form-type="submit">报名</button>
      </view>
    </view>
    <input name="sch_id" hidden="true" value="{{sch_id}}"></input>
    <input name="child_id" hidden="true" value="{{child_id}}"></input>
    <input name="edu_type_id" hidden="true" value="{{edu_type_id}}"></input>
  </form>
</block>

<block wx:if="{{sch_reged}}">
  <view class="weui-cells__title">报名信息</view>
  <view class="weui-cells weui-cells_after-title">
    <view class="weui-cell">
      <view class="weui-cell__bd">报名学校</view>
      <view class="weui-cell__ft">{{sch_name}}</view>
    </view>
    <view class="weui-cell">
      <view class="weui-cell__bd">报名学生</view>
      <view class="weui-cell__ft">{{child_name}}</view>
    </view>
  </view>
  <form bindsubmit="cancelSubmit">
    <view style="margin:0 auto; width: 50%; margin-bottom: 30rpx;" wx:if="{{not_added}}">
      <view class="weui-btn-area">
        <button type="warn" form-type="submit">取消报名</button>
      </view>
    </view>
    <input name="sch_id" hidden="true" value="{{sch_id}}"></input>
    <input name="child_id" hidden="true" value="{{child_id}}"></input>
  </form>

  <block wx:if="{{not_added}}">
    <view class="weui-cells__title">填写报名表格</view>
    <view class="weui-cells weui-cells_after-title">
      <view class="weui-cell weui-cell_select">
        <view class="weui-cell__hd weui-cell__hd_in-select-after">
          <view class="weui-label">表格选择</view>
        </view>
        <view class="weui-cell__bd">
          <picker bindchange="inforChange" value="{{inforIndex}}" range="{{forms}}" range-key="name">
            <view class="weui-select weui-select_in-select-after">{{forms[inforIndex].name}}</view>
          </picker>
        </view>
      </view>
    </view>
  </block>

  <form wx:if="{{form_show}}" bindsubmit="uploadSubmit">
    <view class="weui-cells__title">{{form_name}}</view>
    <view class="weui-cells weui-cells_after-title">
      <block wx:for="{{items}}" wx:key="id">
        <block wx:if="{{item.view_type=='input'}}">
          <view class="weui-cell weui-cell_input">
            <view class="weui-cell__hd">
              <view class="weui-label">{{item.title}}</view>
            </view>
            <view class="weui-cell__bd">
              <input class="weui-input" placeholder="{{item.place_holder}}" name="{{item.name}}" value="{{item.value}}" type="{{item.input_type}}" maxlength="{{item.max_length}}" data-uid="{{item.uid}}" bindblur="checkInput"/>
            </view>
            <view class="weui-cell__ft" wx:if="{{item.error}}">
              <icon type="warn" size="23" color="#E64340"></icon>
            </view>
          </view>
        </block>
        <block wx:if="{{item.view_type=='check'}}">
          <view class="weui-cell weui-cell_switch">
            <view class="weui-cell__bd">{{item.title}}</view>
            <view class="weui-cell__ft">
              <switch name="{{item.name}}" checked />
            </view>
          </view>
        </block>
        <block wx:if="{{item.view_type=='picker'}}">
          <view class="weui-cell weui-cell_select">
            <view class="weui-cell__hd weui-cell__hd_in-select-after">
              <view class="weui-label">{{item.title}}</view>
            </view>
            <view class="weui-cell__bd">
              <picker name="{{item.name}}" data-uid="{{item.uid}}" bindchange="dynamChange" value="{{item.value}}" range="{{item.default_value}}">
                <view class="weui-select weui-select_in-select-after">{{item.default_value[item.value]}}</view>
              </picker>
            </view>
          </view>
        </block>
      </block>
    </view>
    <view style="margin:0 auto; width: 50%; margin-bottom: 30rpx;">
      <view class="weui-btn-area">
        <button type="primary" form-type="submit">上传表格</button>
      </view>
    </view>
    <input name="form_id" hidden="true" value="{{form_id}}"></input>
  </form>
</block>

<block wx:if="{{infor_added}}">
  <view class="weui-cells__title">报名表格 - {{form_name}}</view>
  <view class="weui-cells weui-cells_after-title">
    <block wx:for="{{user_forms}}" wx:key="id">
      <view class="weui-cell">
        <view class="weui-cell__bd">{{item.title}}</view>
        <view class="weui-cell__ft">{{item.value}}</view>
      </view>
    </block>
  </view>
  <view class="qrcode-area">
    <image class="qrcode" src="data:image/png;base64,{{qrcode_data}}"></image>
    <view>{{child_name}}</view>
  </view>
</block>
